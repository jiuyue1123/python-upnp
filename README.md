# UPnP 端口映射工具

一个功能强大的 Python UPnP 端口映射图形化工具，支持端口映射、网络扫描、端口转发等功能。

## ✨ 主要功能

### 🔧 端口映射

- **本机 IP 映射**：将外网端口映射到本机
- **自定义 IP 映射**：将外网端口映射到网络中的任意设备
- **多种协议支持**：支持 TCP 和 UDP 协议
- **智能重试**：自动尝试多种参数组合，提高成功率

### 🌐 网络管理

- **设备发现**：自动发现网络中的 UPnP 设备
- **网络扫描**：扫描局域网中的活跃设备
- **IP 地址检测**：自动获取本机所有可用 IP 地址
- **连接测试**：测试目标设备和端口的连通性

### 🚀 高级功能

- **端口转发**：绕过路由器限制，实现端口转发
- **端口检查**：检查端口是否可用，避免冲突
- **映射查看**：查看当前所有端口映射
- **实时日志**：彩色分类日志显示，操作状态实时反馈

### 🎨 用户界面

- **现代化设计**：美观的图形界面，支持深色主题
- **直观操作**：简洁明了的操作流程
- **状态监控**：实时显示操作状态和进度
- **响应式布局**：自适应窗口大小，确保最佳显示效果

## 🚀 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

```bash
python upnp_gui.py
```

## 📋 使用说明

### 1. 基本端口映射

1. 启动程序，等待 UPnP 设备发现完成
2. 选择 IP 模式（本机 IP 或自定义 IP）
3. 配置端口参数（外部端口、内部端口、协议）
4. 点击"添加映射"完成端口映射

### 2. 映射到其他设备

1. 选择"自定义 IP 模式"
2. 点击"扫描网络"发现活跃设备
3. 选择目标设备 IP
4. 配置端口参数
5. 点击"添加映射"

### 3. 端口转发功能

当路由器不支持映射到非本机 IP 时：

1. 配置目标设备和端口
2. 点击"端口转发"
3. 程序自动映射到本机并启动转发服务

## 🔧 功能按钮说明

| 按钮        | 功能           | 说明                     |
| ----------- | -------------- | ------------------------ |
| 🟢 添加映射 | 添加端口映射   | 将外网端口映射到内网设备 |
| 🔴 删除映射 | 删除端口映射   | 移除已存在的端口映射     |
| 🔵 刷新设备 | 重新发现设备   | 重新扫描 UPnP 设备       |
| 🟣 扫描网络 | 扫描活跃设备   | 发现网络中的在线设备     |
| 🟠 测试连接 | 测试连通性     | 检查目标设备和端口       |
| 🟢 查看映射 | 查看现有映射   | 显示当前所有端口映射     |
| 🟠 检查端口 | 检查端口可用性 | 验证端口是否可用         |
| 🟣 端口转发 | 启动转发服务   | 绕过路由器限制           |

## 📊 系统要求

- **操作系统**：Windows 10/11, macOS, Linux
- **Python 版本**：3.7+
- **网络环境**：支持 UPnP 的路由器

## 🔍 故障排除

### 常见问题

#### 1. "Invalid Args" 错误

**原因**：路由器不支持映射到非本机 IP
**解决方案**：

- 使用"端口转发"功能
- 切换到"本机 IP 模式"
- 检查路由器 UPnP 设置

#### 2. 设备发现失败

**原因**：网络不支持 UPnP 或防火墙阻止
**解决方案**：

- 检查路由器 UPnP 功能是否开启
- 关闭防火墙或添加程序例外
- 确保设备在同一网段

#### 3. 端口映射失败

**原因**：端口被占用或参数错误
**解决方案**：

- 使用"检查端口"功能
- 尝试其他端口号
- 检查目标设备服务是否运行

## 🛠️ 技术架构

- **GUI 框架**：tkinter
- **UPnP 库**：miniupnpc
- **网络处理**：socket, threading
- **异步操作**：queue, threading

## 📈 版本历史

### v1.0.0 (当前版本)

- ✅ 基础端口映射功能
- ✅ 图形化用户界面
- ✅ 网络扫描和设备发现
- ✅ 端口转发功能
- ✅ 连接测试和诊断
- ✅ 实时日志和状态监控

## 🔮 下个版本计划 (v1.1.0)

### 🆕 新增功能

#### DDNS (动态 DNS) 支持

- **多服务商支持**：
  - No-IP
  - DynDNS
  - Duck DNS
  - 自定义 DDNS 服务商
- **自动更新**：定期更新 IP 地址
- **域名管理**：添加、删除、编辑域名
- **状态监控**：显示 DDNS 更新状态
- **历史记录**：记录 IP 变更历史

#### 增强的网络功能

- **端口范围映射**：支持批量端口映射
- **定时任务**：定时添加/删除映射
- **配置文件**：保存和加载配置
- **导入导出**：映射规则导入导出

#### 用户界面改进

- **主题切换**：支持明暗主题
- **语言支持**：多语言界面
- **快捷键**：键盘快捷键支持
- **托盘图标**：系统托盘最小化

#### 高级功能

- **脚本支持**：自定义脚本执行
- **API 接口**：REST API 支持
- **远程管理**：Web 管理界面
- **日志导出**：日志文件导出

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📄 许可证

MIT License

## 📞 支持

如果遇到问题或有建议，请提交 Issue 或联系开发者。

---

**注意**：使用端口映射功能时，请注意网络安全，确保只映射必要的端口，避免安全风险。
